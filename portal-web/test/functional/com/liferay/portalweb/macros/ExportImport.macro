definition {

	macro addSourceContent {
		Click(locator1 = "CKEditor#TOOLBAR_SOURCE_BUTTON");

		Type.typeCodeMirrorEditorNoError(
			locator1 = "CKEditor#BODY_FIELD_SOURCE_ON",
			value1 = ${content});

		Click(locator1 = "CKEditor#TOOLBAR_SOURCE_BUTTON");
	}

	macro configureURLPattern {
		Type(
			locator1 = "ExportImport#URL_PATTERN",
			value1 = ${urlPattern});

		if (isSet(multipleURL)) {
			Click.javaScriptClick(
				key_title = "Duplicate",
				locator1 = "Button#ANY_TITLE");

			FormFields.editRepeatableTextMultiline(
				fieldName = "URLPatterns",
				fieldValue = ${multipleURL},
				repeatableFieldNumber = 2);
		}

		if (IsElementPresent(locator1 = "Button#SAVE")) {
			PortletEntry.save();
		}
		else {
			Button.clickUpdate();
		}

		if (isSet(errorMessage)) {
			AssertTextEquals.assertPartialText(
				locator1 = "Message#ERROR_DISMISSIBLE",
				value1 = ${errorMessage});
		}
		else {
			Alert.viewSuccessMessage();
		}
	}

	macro deployInstanceConfigFile {
		var companyId = JSONCompany.getCompanyId(portalInstanceName = ${portalInstanceName});

		AntCommands.runCommand("build-test-export-import.xml", "prepare-export-import-osgi-configuration -DcompanyId=${companyId} -Dosgi.config.file.name=${osgiConfigFileName}");
	}

	macro getBackgroundTaskStatus {
		if (${type} == "Export") {
			var mysqlStatement = "SELECT backgroundTaskId FROM BackgroundTask WHERE taskExecutorClassName in ('com.liferay.exportimport.internal.background.task.LayoutExportBackgroundTaskExecutor', 'com.liferay.exportimport.internal.background.task.PortletExportBackgroundTaskExecutor') AND STATUS IN (3, 5);";

			var sqlResults = SQL.executeMySQLStatement(mysqlStatement = ${mysqlStatement});

			var getRecord = StringUtil.regexReplaceAll(${sqlResults}, "[backgroundTaskId\n]", "");
		}
		else if (${type} == "Import") {
			var mysqlStatement = "SELECT backgroundTaskId FROM BackgroundTask WHERE taskExecutorClassName in ('com.liferay.exportimport.internal.background.task.LayoutImportBackgroundTaskExecutor', 'com.liferay.exportimport.internal.background.task.PortletImportBackgroundTaskExecutor') AND STATUS IN (3, 5);";

			var sqlResults = SQL.executeMySQLStatement(mysqlStatement = ${mysqlStatement});

			var getRecord = StringUtil.regexReplaceAll(${sqlResults}, "[backgroundTaskId\n]", "");
		}

		if (${getRecord} == "") {
			return "Deleted successfully";
		}
		else {
			return "Failed to delete";
		}
	}

	macro getLARFileStatus {
		var mysqlStatement = "SELECT title FROM DLFileEntry WHERE title LIKE '%.lar';";

		var sqlResults = SQL.executeMySQLStatement(mysqlStatement = ${mysqlStatement});

		var getRecord = StringUtil.regexReplaceAll(${sqlResults}, "[title\n]", "");

		if (${getRecord} == "") {
			return "Deleted successfully";
		}
		else {
			return "Failed to delete";
		}
	}

	macro updateLayoutBackgroundTaskModifiedDateToPast {
		if (${type} == "Export") {
			var mysqlStatement = "SELECT backgroundTaskId FROM BackgroundTask WHERE taskExecutorClassName in ('com.liferay.exportimport.internal.background.task.LayoutExportBackgroundTaskExecutor') AND STATUS IN (3, 5);";

			var sqlResults = SQL.executeMySQLStatement(mysqlStatement = ${mysqlStatement});

			var backgroundTaskId = StringUtil.regexReplaceAll(${sqlResults}, "[backgroundTaskId\n]", "");

			echo("## * backgroundTaskId is: ${backgroundTaskId}");
		}
		else if (${type} == "Import") {
			var mysqlStatement = "SELECT backgroundTaskId FROM BackgroundTask WHERE taskExecutorClassName in ('com.liferay.exportimport.internal.background.task.LayoutImportBackgroundTaskExecutor') AND STATUS IN (3, 5);";

			var sqlResults = SQL.executeMySQLStatement(mysqlStatement = ${mysqlStatement});

			var backgroundTaskId = StringUtil.regexReplaceAll(${sqlResults}, "[backgroundTaskId\n]", "");

			echo("## * backgroundTaskId is: ${backgroundTaskId}");
		}

		var mysqlStatement = "UPDATE BackgroundTask SET modifiedDate = '2023-03-20 04:20:24.321000' WHERE (backgroundTaskId = ${backgroundTaskId});";

		var sqlResults = SQL.executeMySQLStatement(mysqlStatement = ${mysqlStatement});

		var queryResult = StringUtil.regexReplaceAll(${sqlResults}, "[\r\n]", "");

		if (${queryResult} != "") {
			fail("The modifiedDate of the layout background task failed to modify.");
		}
	}

	macro updatePortletBackgroundTaskModifiedDateToPast {
		if (${type} == "Export") {
			var mysqlStatement = "SELECT backgroundTaskId FROM BackgroundTask WHERE taskExecutorClassName in ('com.liferay.exportimport.internal.background.task.PortletExportBackgroundTaskExecutor') AND STATUS IN (3, 5);";

			var sqlResults = SQL.executeMySQLStatement(mysqlStatement = ${mysqlStatement});

			var backgroundTaskId = StringUtil.regexReplaceAll(${sqlResults}, "[backgroundTaskId\n]", "");

			echo("## * backgroundTaskId is: ${backgroundTaskId}");
		}
		else if (${type} == "Import") {
			var mysqlStatement = "SELECT backgroundTaskId FROM BackgroundTask WHERE taskExecutorClassName in ('com.liferay.exportimport.internal.background.task.PortletImportBackgroundTaskExecutor') AND STATUS IN (3, 5);";

			var sqlResults = SQL.executeMySQLStatement(mysqlStatement = ${mysqlStatement});

			var backgroundTaskId = StringUtil.regexReplaceAll(${sqlResults}, "[backgroundTaskId\n]", "");

			echo("## * backgroundTaskId is: ${backgroundTaskId}");
		}

		var mysqlStatement = "UPDATE BackgroundTask SET modifiedDate = '2023-03-20 04:20:24.321000' WHERE (backgroundTaskId = ${backgroundTaskId});";

		var sqlResults = SQL.executeMySQLStatement(mysqlStatement = ${mysqlStatement});

		var queryResult = StringUtil.regexReplaceAll(${sqlResults}, "[\r\n]", "");

		if (${queryResult} != "") {
			fail("The modifiedDate of the portlet background task failed to modify.");
		}
	}

	macro viewValidationMessage {
		AssertTextPresent(
			locator1 = "Message#ERROR",
			value1 = "Your request failed to complete.");

		AssertTextEquals.assertPartialText(
			locator1 = "Message#ERROR_DISMISSIBLE",
			value1 = "Unable to validate referenced page with URL ${url} because the page group with URL ${urlPattern} cannot be found");
	}

}