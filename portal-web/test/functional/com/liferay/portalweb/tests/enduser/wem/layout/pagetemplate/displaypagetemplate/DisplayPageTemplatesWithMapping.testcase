@component-name = "portal-wcm"
definition {

	property ci.retries.disabled = "true";
	property portal.release = "true";
	property portal.upstream = "true";
	property testray.main.component.name = "Display Page Templates";

	static var randomSiteName = StringUtil.randomString(8);

	var siteURLKey = StringUtil.toLowerCase(${randomSiteName});

	setUp {
		task ("Set up virtual instance") {
			TestCase.setUpPortalInstance();
		}

		task ("Sign in") {
			User.firstLoginPG();
		}

		task ("Add a site") {
			HeadlessSite.addSite(siteName = ${randomSiteName});
		}

		task ("Add a display page template for Web Content Article and Basic Web Content") {
			JSONLayoutpagetemplate.addDisplayPageTemplateEntry(
				contentType = "Web Content Article",
				displayPageTemplateEntryName = "Display Page Name",
				groupName = ${randomSiteName},
				subType = "Basic Web Content");
		}
	}

	@description = "This is a test for LPS-86550. Users should be able to map author name and author profile image to editable fields in a display page template."
	@priority = 5
	test MapAuthorInfoToEditableField {
		property custom.properties = "jsonws.web.service.paths.excludes=";
		property portal.acceptance = "true";

		var userEmailAddress = StringUtil.randomString(8);
		var userFirstName = StringUtil.randomString(8);
		var userLastName = StringUtil.randomString(8);
		var userScreenName = StringUtil.randomString(8);

		task ("Add a Banner Center to display page template") {
			DisplayPageTemplatesAdmin.openDisplayPagesAdmin(siteURLKey = ${siteURLKey});

			DisplayPageTemplatesAdmin.gotoDisplayPage(displayPageName = "Display Page Name");

			PageEditor.addFragment(
				collectionName = "Featured Content",
				composition = "true",
				fragmentName = "Banner Center");
		}

		task ("Map the Author Name to title editable field") {
			PageEditorMapping.mapEditableTextToField(
				field = "Author Name",
				fragmentName = "Heading",
				id = "element-text");
		}

		task ("Map the Author Profile Image to background image editable field") {
			PageEditor.editLayoutContainer(
				backgroundImage = "Mapping",
				fieldName = "Author Profile Image",
				panel = "Styles");

			PageEditor.publish();
		}

		task ("Add a new user with Administrator role") {
			JSONUser.addUser(
				userEmailAddress = StringUtil.toLowerCase("${userEmailAddress}@liferay.com"),
				userFirstName = ${userFirstName},
				userLastName = ${userLastName},
				userScreenName = StringUtil.toLowerCase(${userScreenName}));

			JSONUser.setFirstPassword(
				agreeToTermsAndAnswerReminderQuery = "true",
				requireReset = "false",
				userEmailAddress = StringUtil.toLowerCase("${userEmailAddress}@liferay.com"));

			JSONRole.assignRoleToUser(
				roleTitle = "Administrator",
				userEmailAddress = StringUtil.toLowerCase("${userEmailAddress}@liferay.com"));
		}

		task ("Sign in as the new user") {
			User.logoutAndLoginPG(userLoginEmailAddress = StringUtil.toLowerCase("${userEmailAddress}@liferay.com"));
		}

		task ("Change the profile image for new user") {
			MyAccount.openMyAccountAdmin();

			User.changeProfileImage(imageName = "marketplace_icon.png");

			PortletEntry.save();

			var userPortrait = selenium.getAttribute("//img[contains(@class,'logo-selector') and contains(@src,'image')]@src");

			var userPortrait = StringUtil.extractLast(${userPortrait}, "image/");
		}

		task ("Add a web content and select the display page template") {
			WebContentNavigator.openWebContentAdmin(siteURLKey = ${siteURLKey});

			WebContentNavigator.gotoAddCP();

			WebContent.addCP(
				webContentContent = "Webcontent Content",
				webContentTitle = "Webcontent Title");

			WebContent.editDisplayPage(
				pageName = "Display Page Name",
				pageType = "Display Page Templates");

			PortletEntry.publish();
		}

		task ("Navigate to the display page template at view mode") {
			Navigator.openWithAppendToBaseURL(urlAppend = "web/${siteURLKey}/w/webcontent-title");
		}

		task ("View mapped content in display page template") {
			ContentPages.viewFragmentText(
				fragmentName = "heading",
				id = "element-text",
				text = "${userFirstName} ${userLastName}");

			ContentPages.viewFragmentBackgroundImage(image = ${userPortrait});
		}
	}

	@description = "This is a test for LPS-128645. Map custom field to text fragment."
	@priority = 4
	test MapCustomFieldToTextFragment {
		task ("Add a custom field for Document") {
			ApplicationsMenu.gotoPortlet(
				category = "Configuration",
				panel = "Control Panel",
				portlet = "Custom Fields");

			CustomFields.addCP(
				customFieldName = "Short Description",
				customFieldType = "Input Field",
				customInputDataType = "Text",
				resourceName = "Document");
		}

		task ("Add a document based on Basic Document") {
			DMNavigator.openDocumentsAndMediaAdmin(siteURLKey = ${siteURLKey});

			DMDocument.addCP(
				customFieldText = "This is a short description",
				dmDocumentFile = "Document_1.jpg",
				dmDocumentTitle = "DM Title");
		}

		task ("Add a display page template with Document and Basic Document") {
			DisplayPageTemplatesAdmin.openDisplayPagesAdmin(siteURLKey = ${siteURLKey});

			DisplayPageTemplatesAdmin.addDisplayPage(
				contentType = "Document",
				displayPageName = "DPT Name",
				subType = "Basic Document");
		}

		task ("Add a Heading fragment to display page template") {
			PageEditor.addFragment(
				collectionName = "Basic Components",
				fragmentName = "Heading");
		}

		task ("Map custom field to editable field of Heading") {
			PageEditorMapping.mapEditableTextToField(
				field = "Short Description",
				fragmentName = "Heading",
				id = "element-text");

			PageEditor.publish();
		}

		task ("Mark the display page template as default") {
			DisplayPageTemplatesAdmin.markDisplayPageAsDefault(displayPageName = "DPT Name");
		}

		task ("Assert the mapped custom field is shown in display page template") {
			var fileEntryId = JSONDocument.getFileEntryId(
				dmDocumentTitle = "DM Title",
				groupName = ${randomSiteName});

			Navigator.openWithAppendToBaseURL(urlAppend = "web/${siteURLKey}/d/${fileEntryId}");

			ControlMenu.viewHeaderTitle(headerTitle = "DM Title");

			ContentPages.viewFragmentText(
				fragmentName = "heading",
				id = "element-text",
				text = "This is a short description");
		}
	}

	@description = "This is a test for LPS-86550. Users should be able to map last editor name and author profile image to editable fields in a display page template."
	@priority = 5
	test MapLastEditorInfoToEditableField {
		property custom.properties = "jsonws.web.service.paths.excludes=";
		property portal.acceptance = "true";

		var userEmailAddress = StringUtil.randomString(8);
		var userFirstName = StringUtil.randomString(8);
		var userLastName = StringUtil.randomString(8);
		var userScreenName = StringUtil.randomString(8);

		task ("Add a Banner Center to display page template") {
			DisplayPageTemplatesAdmin.openDisplayPagesAdmin(siteURLKey = ${siteURLKey});

			DisplayPageTemplatesAdmin.gotoDisplayPage(displayPageName = "Display Page Name");

			PageEditor.addFragment(
				collectionName = "Featured Content",
				composition = "true",
				fragmentName = "Banner Center");
		}

		task ("Map the Last Editor Name to title editable field") {
			PageEditorMapping.mapEditableTextToField(
				field = "Last Editor Name",
				fragmentName = "Heading",
				id = "element-text");
		}

		task ("Map the Last Editor Profile Image to background image editable field") {
			PageEditor.editLayoutContainer(
				backgroundImage = "Mapping",
				fieldName = "Last Editor Profile Image",
				panel = "Styles");

			PageEditor.publish();
		}

		task ("Mark the display page as default") {
			DisplayPageTemplatesAdmin.markDisplayPageAsDefault(displayPageName = "Display Page Name");
		}

		task ("Add a web content article") {
			JSONWebcontent.addWebContent(
				content = "Webcontent Content",
				groupName = ${randomSiteName},
				title = "Webcontent Title");
		}

		task ("Get user portrait info") {
			MyAccount.openMyAccountAdmin();

			AssertVisible(
				key_imageName = "image",
				locator1 = "UsersAndOrganizationsEditUser#DETAILS_PROFILE_IMAGE");

			var userPortrait = selenium.getAttribute("//img[contains(@class,'logo-selector') and contains(@src,'image')]@src");

			var userPortrait = StringUtil.extractLast(${userPortrait}, "image/");
		}

		task ("Navigate to the display page template at view mode") {
			Navigator.openWithAppendToBaseURL(urlAppend = "web/${siteURLKey}/w/webcontent-title");
		}

		task ("View mapped content in display page template") {
			ContentPages.viewFragmentText(
				fragmentName = "heading",
				id = "element-text",
				text = "Test Test");

			ContentPages.viewFragmentBackgroundImage(image = ${userPortrait});
		}

		task ("Add a new user with Administrator role") {
			JSONUser.addUser(
				userEmailAddress = StringUtil.toLowerCase("${userEmailAddress}@liferay.com"),
				userFirstName = ${userFirstName},
				userLastName = ${userLastName},
				userScreenName = StringUtil.toLowerCase(${userScreenName}));

			JSONUser.setFirstPassword(
				agreeToTermsAndAnswerReminderQuery = "true",
				requireReset = "false",
				userEmailAddress = StringUtil.toLowerCase("${userEmailAddress}@liferay.com"));

			JSONRole.assignRoleToUser(
				roleTitle = "Administrator",
				userEmailAddress = StringUtil.toLowerCase("${userEmailAddress}@liferay.com"));
		}

		task ("Sign in as the new user") {
			User.logoutAndLoginPG(userLoginEmailAddress = StringUtil.toLowerCase("${userEmailAddress}@liferay.com"));
		}

		task ("Change the profile image for new user") {
			MyAccount.openMyAccountAdmin();

			User.changeProfileImage(imageName = "marketplace_icon.png");

			PortletEntry.save();

			var userPortrait = selenium.getAttribute("//img[contains(@class,'logo-selector') and contains(@src,'image')]@src");

			var userPortrait = StringUtil.extractLast(${userPortrait}, "image/");
		}

		task ("Edit the web content") {
			WebContentNavigator.openWebContentAdmin(siteURLKey = ${siteURLKey});

			WebContentNavigator.gotoEditCP(webContentTitle = "Webcontent Title");

			WebContent.editCP(
				webContentContentEdit = "Webcontent Content Edit",
				webContentTitleEdit = "Webcontent Title Edit");
		}

		task ("Navigate to the display page template at view mode") {
			Navigator.openWithAppendToBaseURL(urlAppend = "web/${siteURLKey}/w/webcontent-title");
		}

		task ("View mapped content in display page template") {
			ContentPages.viewFragmentText(
				fragmentName = "heading",
				id = "element-text",
				text = "${userFirstName} ${userLastName}");

			ContentPages.viewFragmentBackgroundImage(image = ${userPortrait});
		}
	}

	@description = "This is a test for LPS-98031. Map manual URL to image fragment."
	@priority = 4
	test MapManualURLToImageFragment {
		task ("Add an Image fragment to the Display Page Name") {
			DisplayPageTemplatesAdmin.openDisplayPagesAdmin(siteURLKey = ${siteURLKey});

			DisplayPageTemplatesAdmin.gotoDisplayPage(displayPageName = "Display Page Name");

			PageEditor.addFragment(
				collectionName = "Basic Components",
				fragmentName = "Image");
		}

		task ("Map manual URL to editable field of Image") {
			PageEditor.editFragmentImage(
				fileName = "Document_1.jpg",
				fragmentName = "Image",
				id = "image-square");

			PageEditorEditableLink.gotoEditableFieldLink(
				fragmentName = "Image",
				id = "image-square");

			PageEditorEditableLink.updateURL(url = "https://liferay.com");

			AssertVisible(
				key_append = "//img[contains(@src,'document_1-jpg')]",
				key_url = "https://liferay.com",
				locator1 = "Fragment#FRAGMENT_LINK");

			PageEditor.publish();
		}

		task ("Add a web content based on Basic Web Content") {
			JSONWebcontent.addWebContent(
				content = "Web Content Content",
				groupName = ${randomSiteName},
				title = "Web Content Title");
		}

		task ("Select Display Page Name as Specific Display Page Template") {
			WebContentNavigator.openWebContentAdmin(siteURLKey = ${siteURLKey});

			WebContentNavigator.gotoEditCP(webContentTitle = "Web Content Title");

			WebContent.editDisplayPage(
				pageName = "Display Page Name",
				pageType = "Display Page Templates");

			PortletEntry.publish();
		}

		task ("View Content in display page template") {
			WebContentNavigator.openWebContentAdmin(siteURLKey = ${siteURLKey});

			WebContentNavigator.gotoEntryMenuItem(
				entry = "Web Content Title",
				menuItem = "View Content");

			ControlMenu.viewHeaderTitle(headerTitle = "Web Content Title");
		}

		task ("Assert mapped URL work in display page template") {
			AssertVisible(
				key_append = "//img[contains(@src,'document_1-jpg')]",
				key_url = "https://liferay.com",
				locator1 = "Fragment#FRAGMENT_LINK");

			Click(
				key_append = "//img[contains(@src,'document_1-jpg')]",
				key_url = "https://liferay.com",
				locator1 = "Fragment#FRAGMENT_LINK");

			AssertLocation.assertPartialLocation(value1 = "https://www.liferay.com");
		}
	}

	@description = "This is a test for LPS-98031. Map manual URL to link fragment."
	@priority = 5
	test MapManualURLToLinkFragment {
		property portal.acceptance = "true";

		task ("Add a Banner Center to display page template") {
			DisplayPageTemplatesAdmin.openDisplayPagesAdmin(siteURLKey = ${siteURLKey});

			DisplayPageTemplatesAdmin.gotoDisplayPage(displayPageName = "Display Page Name");

			PageEditor.addFragment(
				collectionName = "Featured Content",
				composition = "true",
				fragmentName = "Banner Center");
		}

		task ("Map the manual URL to link editable field") {
			PageEditorEditableLink.gotoEditableFieldLink(
				fragmentName = "Button",
				id = "link");

			PageEditorEditableLink.updateURL(url = "https://liferay.com");

			PageEditor.publish();
		}

		task ("View the mapped URL in link editable field") {
			DisplayPageTemplatesAdmin.openDisplayPagesAdmin(siteURLKey = ${siteURLKey});

			DisplayPageTemplatesAdmin.gotoDisplayPageEllipsisItem(
				displayPageName = "Display Page Name",
				item = "Edit");

			AssertVisible(locator1 = "//a[contains(@class,'btn')][contains(@href,'https://liferay.com')]");
		}
	}

	@description = "This is a test for LPS-98031. Map manual URL to text fragment."
	@priority = 4
	test MapManualURLToTextFragment {
		task ("Add a Heading fragment to the Display Page Name") {
			DisplayPageTemplatesAdmin.openDisplayPagesAdmin(siteURLKey = ${siteURLKey});

			DisplayPageTemplatesAdmin.gotoDisplayPage(displayPageName = "Display Page Name");

			PageEditor.addFragment(
				collectionName = "Basic Components",
				fragmentName = "Heading");
		}

		task ("Map manual URL to editable field of Heading") {
			PageEditorEditableLink.gotoEditableFieldLink(
				fragmentName = "Heading",
				id = "element-text");

			PageEditorEditableLink.updateURL(url = "https://liferay.com");

			AssertVisible(
				key_append = "[normalize-space(text())='Heading Example']",
				key_url = "https://liferay.com",
				locator1 = "Fragment#FRAGMENT_LINK");

			PageEditor.publish();
		}

		task ("Add a web content based on Basic Web Content") {
			JSONWebcontent.addWebContent(
				content = "Web Content Content",
				groupName = ${randomSiteName},
				title = "Web Content Title");
		}

		task ("Select Display Page Name as Specific Display Page Template") {
			WebContentNavigator.openWebContentAdmin(siteURLKey = ${siteURLKey});

			WebContentNavigator.gotoEditCP(webContentTitle = "Web Content Title");

			WebContent.editDisplayPage(
				pageName = "Display Page Name",
				pageType = "Display Page Templates");

			PortletEntry.publish();
		}

		task ("View Content in display page template") {
			WebContentNavigator.openWebContentAdmin(siteURLKey = ${siteURLKey});

			WebContentNavigator.gotoEntryMenuItem(
				entry = "Web Content Title",
				menuItem = "View Content");

			ControlMenu.viewHeaderTitle(headerTitle = "Web Content Title");
		}

		task ("Assert mapped URL work in view mode") {
			AssertVisible(
				key_append = "[normalize-space(text())='Heading Example']",
				key_url = "https://liferay.com",
				locator1 = "Fragment#FRAGMENT_LINK");

			Click(
				key_append = "[normalize-space(text())='Heading Example']",
				key_url = "https://liferay.com",
				locator1 = "Fragment#FRAGMENT_LINK");

			AssertLocation.assertPartialLocation(value1 = "https://www.liferay.com");
		}
	}

	@description = "Map multiple custom ddm fields to text editable fields."
	@priority = 4
	test MapMultipleCustomDDMFieldsToTextFragment {
		task ("Add a web content structure") {
			WebContentNavigator.openWebContentAdmin(siteURLKey = ${siteURLKey});

			NavItem.gotoStructures();

			WebContentStructures.addCP(structureName = "WC Structure Name");

			DataEngine.addFields(fieldNameList = "Text,Rich Text");

			WebContentStructures.saveCP();
		}

		task ("Add a display page template for Web Content Article and new structure") {
			DisplayPageTemplatesAdmin.openDisplayPagesAdmin(siteURLKey = ${siteURLKey});

			DisplayPageTemplatesAdmin.addDisplayPage(
				contentType = "Web Content Article",
				displayPageName = "DPT for New Structure",
				subType = "WC Structure Name");
		}

		task ("Add a Banner Center fragment to display page template") {
			PageEditor.addFragment(
				collectionName = "Featured Content",
				composition = "true",
				fragmentName = "Banner Center");
		}

		task ("Map the Text to title editable field") {
			PageEditorMapping.mapEditableTextToField(
				field = "Text",
				fragmentName = "Heading",
				id = "element-text");
		}

		task ("Map the Rich Text to subtitle editable field") {
			PageEditorMapping.mapEditableTextToField(
				field = "Rich Text",
				fragmentName = "Paragraph",
				id = "element-text");

			PageEditor.publish();
		}

		task ("Add a web content based on new structure") {
			WebContentNavigator.openWebContentAdmin(siteURLKey = ${siteURLKey});

			WebContentNavigator.gotoAddWithStructureCP(structureName = "WC Structure Name");

			WebContent.addWithStructureCP(
				webContentRichText = "Webcontent Rich Text",
				webContentText = "Webcontent Text",
				webContentTitle = "Webcontent Title");

			WebContent.editDisplayPage(
				pageName = "DPT for New Structure",
				pageType = "Display Page Templates");

			PortletEntry.publish();
		}

		task ("Navigate to the display page template at view mode") {
			Navigator.openWithAppendToBaseURL(urlAppend = "web/${siteURLKey}/w/webcontent-title");
		}

		task ("View mapped content in display page template") {
			ContentPages.viewFragmentText(
				fragmentName = "heading",
				id = "element-text",
				text = "Webcontent Text");

			ContentPages.viewFragmentText(
				fragmentName = "paragraph",
				id = "element-text",
				text = "Webcontent Rich Text");
		}
	}

	@description = "Map multiple fields to text editable fields."
	@priority = 4
	test MapMultipleFieldsToTextFragment {
		task ("Import fragment collection") {
			FragmentsAdminNavigator.openFragmentsAdmin(siteURLKey = ${siteURLKey});

			FragmentsAdmin.importCollectionFromDependenciesFolder(collectionZipFile = "fragment-collection.zip");
		}

		task ("Add a Multiple Editables fragment to display page template") {
			DisplayPageTemplatesAdmin.openDisplayPagesAdmin(siteURLKey = ${siteURLKey});

			DisplayPageTemplatesAdmin.gotoDisplayPage(displayPageName = "Display Page Name");

			PageEditor.addFragment(
				collectionName = "Collection Name",
				fragmentName = "Multiple Editables");
		}

		task ("Map multiple fields to editable fields") {
			var n = 1;

			for (var fieldName : list "Title,Content,Author Name,Display Page URL,Tags") {
				PageEditorMapping.mapEditableTextToField(
					contributed = "false",
					field = ${fieldName},
					fragmentName = "Multiple Editables",
					index = ${n});

				var n = ${n} + 1;
			}

			PageEditor.publish();
		}

		task ("Mark the display page as default") {
			DisplayPageTemplatesAdmin.markDisplayPageAsDefault(displayPageName = "Display Page Name");
		}

		task ("Add a web content article with three tags") {
			JSONWebcontent.addWebContent(
				assetTagNames = "tag1,tag2,tag3",
				content = "Webcontent Content",
				groupName = ${randomSiteName},
				title = "Webcontent Title");
		}

		task ("Navigate to the display page template at view mode") {
			Navigator.openWithAppendToBaseURL(urlAppend = "web/${siteURLKey}/w/webcontent-title");
		}

		task ("View mapped content in display page template") {
			var portalURL = PropsUtil.get("portal.url");
			var n = 1;

			for (var content : list "Webcontent Title,Webcontent Content,Test Test,${portalURL}/web/${siteURLKey}/w/webcontent-title") {
				ContentPages.viewFragmentText(
					contributed = "false",
					fragmentName = "multiple-editables",
					position = ${n},
					text = ${content});

				var n = ${n} + 1;
			}

			ContentPages.viewFragmentText(
				contributed = "false",
				fragmentName = "multiple-editables",
				position = 5,
				text = "tag1, tag2, tag3");
		}
	}

	@description = "This is a use case for LPS-182999. The page designer could see mapped image from attachment field on associated display page template."
	@priority = 4
	test MapPreviewURLOfImageAttachmentToFragment {
		property test.liferay.virtual.instance = "false";
		property test.run.type = "single";

		var labelName = StringUtil.randomString(8);

		var objectName = "A${labelName}";

		task ("Given a page designer has an object entry with an image attachment") {
			ObjectAdmin.addObjectViaAPI(
				labelName = ${labelName},
				objectName = ${objectName},
				pluralLabelName = "${labelName}s");

			ObjectAdmin.addObjectFieldViaAPI(
				fieldBusinessType = "Attachment",
				fieldLabelName = "Upload",
				fieldName = "upload",
				fieldType = "Long",
				fileSource = "userComputer",
				isRequired = "false",
				objectName = ${objectName});

			ObjectAdmin.publishObjectViaAPI(objectName = ${objectName});

			ObjectAdmin.goToCustomObject(objectName = ${objectName});

			ObjectAutoGenerated.addAttachment(fileName = "Document_1.jpg");

			ObjectAutoGenerated.viewFilePresentOnAttachment(fileOnAttachment = "Document_1.jpg");

			PortletEntry.save();

			Navigator.gotoBack();

			WaitForElementPresent(
				key_name = "Document_1.jpg",
				locator1 = "ObjectAdmin#TABLE_LIST_TITLE");

			var objectEntryId = selenium.getText("ObjectPortlet#ENTRY_ID");
		}

		task ("When the page designer maps the Preview URL of image to the Image fragment on display page template") {
			DisplayPageTemplatesAdmin.openDisplayPagesAdmin(siteURLKey = ${siteURLKey});

			DisplayPageTemplatesAdmin.addDisplayPage(
				contentType = ${labelName},
				displayPageName = "Display Page Name 1");

			PageEditor.addFragment(
				collectionName = "Basic Components",
				fragmentName = "Image");

			PageEditorMapping.mapEditableTextToField(
				field = "Preview URL",
				fragmentName = "Image",
				id = "image-square");

			PageEditor.publish();

			DisplayPageTemplatesAdmin.markDisplayPageAsDefault(displayPageName = "Display Page Name 1");

			JSONLayout.addPublicLayout(
				groupName = ${randomSiteName},
				layoutName = "Test Page Name",
				type = "content");

			ContentPagesNavigator.openEditContentPage(
				pageName = "Test Page Name",
				siteName = ${randomSiteName});

			PageEditor.addFragment(
				collectionName = "Basic Components",
				fragmentName = "Button");

			PageEditorEditableLink.gotoEditableFieldLink(
				fragmentName = "Button",
				id = "link");

			PageEditorEditableLink.mapURLToAsset(
				entryTitle = ${objectEntryId},
				field = "Display Page URL",
				navItem = "${labelName}s");

			PageEditor.publish();
		}

		task ("Then the page designer should see the mapped image shown on associated display page template") {
			ContentPagesNavigator.openViewContentPage(
				pageName = "Test Page Name",
				siteName = ${randomSiteName});

			Button.click(button = "Go Somewhere");

			ControlMenu.viewHeaderTitle(headerTitle = ${objectEntryId});

			PageEditor.viewFragmentEditableImage(
				id = "image-square",
				imageDescription = "",
				imageFileName = "Document_1.jpg");
		}
	}

	@description = "This is a test for LPS-165556. The page designer could map a standalone action from current object to Button fragment in display page template."
	@priority = 4
	test MapStandaloneActionFromCurrentObjectToFragment {
		var labelName = StringUtil.randomString(8);

		var objectName = "A${labelName}";

		task ("Given a page creator has a display page template with a Button fragment") {
			for (var i : list "1,2") {
				ObjectAdmin.addObjectViaAPI(
					labelName = "${labelName}${i}",
					objectName = "${objectName}${i}",
					pluralLabelName = "${labelName}${i}s");

				ObjectAdmin.addObjectFieldViaAPI(
					fieldBusinessType = "Text",
					fieldLabelName = "Name",
					fieldName = "name",
					fieldType = "String",
					isRequired = "false",
					objectName = "${objectName}${i}");

				ObjectAdmin.publishObjectViaAPI(objectName = "${objectName}${i}");
			}

			ObjectAdmin.openObjectAdmin();

			ObjectPortlet.selectCustomObject(label = "${labelName}2");

			ObjectAdmin.goToActionsTab();

			ObjectAdmin.addObjectActionViaUI(
				actionLabel = "Vote",
				active = "true",
				errorMessage = "You don't have permissions.",
				fieldName = "Name",
				inputExpressionValue = "name",
				inputMethod = "false",
				objectLabel = "${labelName}1",
				thenAction = "Add an Object Entry",
				whenAction = "Standalone");

			var objectEntryId = ObjectAdmin.addObjectSingleFieldEntryViaAPI(
				fieldName = "name",
				objectName = "${objectName}2",
				value = "Liferay");

			DisplayPageTemplatesAdmin.openDisplayPagesAdmin(siteURLKey = ${siteURLKey});

			DisplayPageTemplatesAdmin.addDisplayPage(
				contentType = "${labelName}2",
				displayPageName = "Display Page Name 1");

			PageEditor.addFragment(
				collectionName = "Basic Components",
				fragmentName = "Button");
		}

		task ("When the page creator navigates to the Action panel of Button fragment") {
			PageEditorAction.gotoEditableFieldAction(
				className = "btn",
				fragmentName = "Button",
				id = "action");

			AssertSelectedLabel(
				key_fieldLabel = "Source",
				locator1 = "Select#GENERIC_SELECT_FIELD",
				value1 = "${labelName}2 (Default)");
		}

		task ("Then the page creator could map the standalone action to Button fragment") {
			PageEditor.configureFragment(
				action = "Vote",
				successInteraction = "Show Notification");

			PageEditor.publish();

			DisplayPageTemplatesAdmin.markDisplayPageAsDefault(displayPageName = "Display Page Name 1");
		}

		task ("When the page creator navigates to the assoicated display page template") {
			JSONLayout.addPublicLayout(
				groupName = ${randomSiteName},
				layoutName = "Test Page Name",
				type = "content");

			ContentPagesNavigator.openEditContentPage(
				pageName = "Test Page Name",
				siteName = ${randomSiteName});

			PageEditor.addFragment(
				collectionName = "Basic Components",
				fragmentName = "Heading");

			PageEditorEditableLink.gotoEditableFieldLink(
				fragmentName = "Heading",
				id = "element-text");

			PageEditorEditableLink.mapURLToAsset(
				entryTitle = ${objectEntryId},
				field = "Display Page URL",
				navItem = "${labelName}2s");

			PageEditor.publish();
		}

		task ("Then the page creator could trigger the standalone action") {
			ContentPagesNavigator.openViewContentPage(
				pageName = "Test Page Name",
				siteName = ${randomSiteName});

			Click(
				key_text = "Heading Example",
				locator1 = "Link#ANY");

			ControlMenu.viewHeaderTitle(headerTitle = "Liferay");

			Button.click(button = "Go Somewhere");

			Alert.viewSuccessMessage();

			ObjectAdmin.goToCustomObject(objectName = "${objectName}1");

			ObjectPortlet.viewEntry(entry = "Liferay");
		}
	}

	@description = "This is a test for LPS-165556. The page designer could map a standalone action from current object to Button fragment inside Colllection Display in display page template."
	@priority = 4
	test MapStandaloneActionFromCurrentObjectToFragmentInsideCollectionDisplay {
		var labelName = StringUtil.randomString(8);

		var objectName = "A${labelName}";

		task ("Given a page creator has a display page template with a Button fragment inside Collection Display") {
			for (var i : list "1,2") {
				ObjectAdmin.addObjectViaAPI(
					labelName = "${labelName}${i}",
					objectName = "${objectName}${i}",
					pluralLabelName = "${labelName}${i}s");

				ObjectAdmin.addObjectFieldViaAPI(
					fieldBusinessType = "Text",
					fieldLabelName = "Name",
					fieldName = "name",
					fieldType = "String",
					isRequired = "false",
					objectName = "${objectName}${i}");

				ObjectAdmin.publishObjectViaAPI(objectName = "${objectName}${i}");
			}

			ObjectAdmin.openObjectAdmin();

			ObjectPortlet.selectCustomObject(label = "${labelName}2");

			ObjectAdmin.goToActionsTab();

			ObjectAdmin.addObjectActionViaUI(
				actionLabel = "Vote",
				active = "true",
				errorMessage = "You don't have permissions.",
				fieldName = "Name",
				inputExpressionValue = "name",
				inputMethod = "false",
				objectLabel = "${labelName}1",
				thenAction = "Add an Object Entry",
				whenAction = "Standalone");

			var objectEntryId = ObjectAdmin.addObjectSingleFieldEntryViaAPI(
				fieldName = "name",
				objectName = "${objectName}2",
				value = "Liferay");

			DisplayPageTemplatesAdmin.openDisplayPagesAdmin(siteURLKey = ${siteURLKey});

			DisplayPageTemplatesAdmin.addDisplayPage(
				contentType = "${labelName}2",
				displayPageName = "Display Page Name 1");

			PageEditor.addFragment(
				collectionName = "Content Display",
				fragmentName = "Collection Display");

			PageEditor.editCollectionDisplay(
				fragmentName = "Collection Display",
				infoListProviderName = "${labelName}2s");

			PageEditor.addFragmentToCollectionDisplay(
				collectionName = "Basic Components",
				entryTitle = "Liferay",
				fragmentName = "Button");
		}

		task ("When the page creator navigates to the Action panel of Button fragment") {
			PageEditorAction.gotoEditableFieldAction(
				className = "btn",
				fragmentName = "Button",
				id = "action");
		}

		task ("Then the page creator could map the standalone action to Button fragment") {
			PageEditor.configureFragment(
				action = "Vote",
				successInteraction = "Show Notification");

			PageEditor.publish();

			DisplayPageTemplatesAdmin.markDisplayPageAsDefault(displayPageName = "Display Page Name 1");
		}

		task ("When the page creator navigates to the assoicated display page template") {
			JSONLayout.addPublicLayout(
				groupName = ${randomSiteName},
				layoutName = "Test Page Name",
				type = "content");

			ContentPagesNavigator.openEditContentPage(
				pageName = "Test Page Name",
				siteName = ${randomSiteName});

			PageEditor.addFragment(
				collectionName = "Basic Components",
				fragmentName = "Heading");

			PageEditorEditableLink.gotoEditableFieldLink(
				fragmentName = "Heading",
				id = "element-text");

			PageEditorEditableLink.mapURLToAsset(
				entryTitle = ${objectEntryId},
				field = "Display Page URL",
				navItem = "${labelName}2s");

			PageEditor.publish();
		}

		task ("Then the page creator could trigger the standalone action") {
			ContentPagesNavigator.openViewContentPage(
				pageName = "Test Page Name",
				siteName = ${randomSiteName});

			Click(
				key_text = "Heading Example",
				locator1 = "Link#ANY");

			ControlMenu.viewHeaderTitle(headerTitle = "Liferay");

			Button.click(button = "Go Somewhere");

			Alert.viewSuccessMessage();

			ObjectAdmin.goToCustomObject(objectName = "${objectName}1");

			ObjectPortlet.viewEntry(entry = "Liferay");
		}
	}

	@description = "This is a test for LPS-165556. The page designer could map a standalone action from a specific object entry to Button fragment in display page template."
	@priority = 4
	test MapStandaloneActionFromSpecificObjectEntryToFragment {
		var labelName = StringUtil.randomString(8);

		var objectName = "A${labelName}";

		task ("Given a page creator has a display page template with a Button fragment") {
			for (var i : list "1,2") {
				ObjectAdmin.addObjectViaAPI(
					labelName = "${labelName}${i}",
					objectName = "${objectName}${i}",
					pluralLabelName = "${labelName}${i}s");

				ObjectAdmin.addObjectFieldViaAPI(
					fieldBusinessType = "Text",
					fieldLabelName = "Name",
					fieldName = "name",
					fieldType = "String",
					isRequired = "false",
					objectName = "${objectName}${i}");

				ObjectAdmin.publishObjectViaAPI(objectName = "${objectName}${i}");
			}

			ObjectAdmin.openObjectAdmin();

			ObjectPortlet.selectCustomObject(label = "${labelName}2");

			ObjectAdmin.goToActionsTab();

			ObjectAdmin.addObjectActionViaUI(
				actionLabel = "Vote",
				active = "true",
				errorMessage = "You don't have permissions.",
				fieldName = "Name",
				inputExpressionValue = "name",
				inputMethod = "false",
				objectLabel = "${labelName}1",
				thenAction = "Add an Object Entry",
				whenAction = "Standalone");

			var objectEntryId1 = ObjectAdmin.addObjectSingleFieldEntryViaAPI(
				fieldName = "name",
				objectName = "${objectName}1",
				value = "Google");
			var objectEntryId2 = ObjectAdmin.addObjectSingleFieldEntryViaAPI(
				fieldName = "name",
				objectName = "${objectName}2",
				value = "Liferay");

			DisplayPageTemplatesAdmin.openDisplayPagesAdmin(siteURLKey = ${siteURLKey});

			DisplayPageTemplatesAdmin.addDisplayPage(
				contentType = "${labelName}1",
				displayPageName = "Display Page Name 1");

			PageEditor.addFragment(
				collectionName = "Basic Components",
				fragmentName = "Button");
		}

		task ("When the page creator navigates to the Action panel of Button fragment") {
			PageEditorAction.gotoEditableFieldAction(
				className = "btn",
				fragmentName = "Button",
				id = "action");
		}

		task ("Then the page creator could map the standalone action from the second object entry to Button fragment") {
			Select(
				key_fieldLabel = "Source",
				locator1 = "Select#GENERIC_SELECT_FIELD",
				value1 = "Specific Content");

			PageEditorMapping.mapEditableFieldToAsset(
				entryTitle = ${objectEntryId2},
				navItem = "${labelName}2s",
				rowItem = "//*[@data-qa-id='row'][contains(.,'${objectEntryId2}')]");

			PageEditor.configureFragment(
				action = "Vote",
				successInteraction = "Show Notification");

			PageEditor.publish();

			DisplayPageTemplatesAdmin.markDisplayPageAsDefault(displayPageName = "Display Page Name 1");
		}

		task ("When the page creator navigates to the assoicated display page template") {
			JSONLayout.addPublicLayout(
				groupName = ${randomSiteName},
				layoutName = "Test Page Name",
				type = "content");

			ContentPagesNavigator.openEditContentPage(
				pageName = "Test Page Name",
				siteName = ${randomSiteName});

			PageEditor.addFragment(
				collectionName = "Basic Components",
				fragmentName = "Heading");

			PageEditorEditableLink.gotoEditableFieldLink(
				fragmentName = "Heading",
				id = "element-text");

			PageEditorEditableLink.mapURLToAsset(
				entryTitle = ${objectEntryId1},
				field = "Display Page URL",
				navItem = "${labelName}1s");

			PageEditor.publish();
		}

		task ("Then the page creator could trigger the standalone action") {
			ContentPagesNavigator.openViewContentPage(
				pageName = "Test Page Name",
				siteName = ${randomSiteName});

			Click(
				key_text = "Heading Example",
				locator1 = "Link#ANY");

			ControlMenu.viewHeaderTitle(headerTitle = "Google");

			Button.click(button = "Go Somewhere");

			Alert.viewSuccessMessage();

			ObjectAdmin.goToCustomObject(objectName = "${objectName}1");

			ObjectPortlet.viewEntry(entry = "Liferay");
		}
	}

	@description = "This is a test for LPS-98031. Map web content field with URL to image editable field."
	@priority = 2
	test MapWebContentFieldWithURLToImageFragment {
		task ("Add a web content structure with a Text field") {
			WebContentNavigator.openWebContentAdmin(siteURLKey = ${siteURLKey});

			NavItem.gotoStructures();

			WebContentStructures.addCP(structureName = "WC Structure Name");

			DataEngine.addField(
				fieldFieldLabel = "Text",
				fieldName = "Text");

			WebContentStructures.saveCP(structureName = "WC Structure Name");
		}

		task ("Add a display page template with Web Content Article and WC Structure Name") {
			DisplayPageTemplatesAdmin.openDisplayPagesAdmin(siteURLKey = ${siteURLKey});

			DisplayPageTemplatesAdmin.addDisplayPage(
				contentType = "Web Content Article",
				displayPageName = "Test Display Page Name",
				subType = "WC Structure Name");
		}

		task ("Add an Image fragment to display page template") {
			PageEditor.addFragment(
				collectionName = "Basic Components",
				fragmentName = "Image");
		}

		task ("Map link from Text field to Image") {
			PageEditorEditableLink.gotoEditableFieldLink(
				fragmentName = "Image",
				id = "image-square");

			PageEditorEditableLink.mapURLToAsset(field = "Text");

			PageEditor.publish();
		}

		task ("Add a web content based on new structure") {
			WebContentNavigator.openWebContentAdmin(siteURLKey = ${siteURLKey});

			WebContentNavigator.gotoAddWithStructureCP(structureName = "WC Structure Name");

			WebContent.addWithStructureCP(
				webContentText = "https://www.liferay.com",
				webContentTitle = "Web Content Title");
		}

		task ("Select Display Page Name as Specific Display Page Template") {
			WebContent.editDisplayPage(
				pageName = "Test Display Page Name",
				pageType = "Display Page Templates");

			PortletEntry.publish();
		}

		task ("View Content in display page template") {
			WebContentNavigator.openWebContentAdmin(siteURLKey = ${siteURLKey});

			WebContentNavigator.gotoEntryMenuItem(
				entry = "Web Content Title",
				menuItem = "View Content");

			ControlMenu.viewHeaderTitle(headerTitle = "Web Content Title");
		}

		task ("Assert mapped URL work in view mode") {
			AssertVisible(
				key_append = "//img[contains(@src,'data:image/png')]",
				key_url = "https://www.liferay.com",
				locator1 = "Fragment#FRAGMENT_LINK");

			Click(
				key_append = "//img[contains(@src,'data:image/png')]",
				key_url = "https://www.liferay.com",
				locator1 = "Fragment#FRAGMENT_LINK");

			AssertLocation.assertPartialLocation(value1 = "https://www.liferay.com");
		}
	}

	@description = "This is a test for LPS-98031. Map web content field with URL to link editable field."
	@priority = 2
	test MapWebContentFieldWithURLToLinkFragment {
		task ("Add a web content structure with a Text field") {
			WebContentNavigator.openWebContentAdmin(siteURLKey = ${siteURLKey});

			NavItem.gotoStructures();

			WebContentStructures.addCP(structureName = "WC Structure Name");

			DataEngine.addField(
				fieldFieldLabel = "Text",
				fieldName = "Text");

			WebContentStructures.saveCP(structureName = "WC Structure Name");
		}

		task ("Add a display page template with Web Content Article and WC Structure Name") {
			DisplayPageTemplatesAdmin.openDisplayPagesAdmin(siteURLKey = ${siteURLKey});

			DisplayPageTemplatesAdmin.addDisplayPage(
				contentType = "Web Content Article",
				displayPageName = "Test Display Page Name",
				subType = "WC Structure Name");
		}

		task ("Add a Button fragment to display page template") {
			PageEditor.addFragment(
				collectionName = "Basic Components",
				fragmentName = "Button");
		}

		task ("Map link from Text field to Button") {
			PageEditorEditableLink.gotoEditableFieldLink(
				fragmentName = "Button",
				id = "link");

			PageEditorEditableLink.mapURLToAsset(field = "Text");

			PageEditor.publish();
		}

		task ("Add a web content based on new structure") {
			WebContentNavigator.openWebContentAdmin(siteURLKey = ${siteURLKey});

			WebContentNavigator.gotoAddWithStructureCP(structureName = "WC Structure Name");

			WebContent.addWithStructureCP(
				webContentText = "https://www.liferay.com",
				webContentTitle = "Web Content Title");
		}

		task ("Select Display Page Name as Specific Display Page Template") {
			WebContent.editDisplayPage(
				pageName = "Test Display Page Name",
				pageType = "Display Page Templates");

			PortletEntry.publish();
		}

		task ("View Content in display page template") {
			WebContentNavigator.openWebContentAdmin(siteURLKey = ${siteURLKey});

			WebContentNavigator.gotoEntryMenuItem(
				entry = "Web Content Title",
				menuItem = "View Content");

			ControlMenu.viewHeaderTitle(headerTitle = "Web Content Title");
		}

		task ("Assert mapped URL work in view mode") {
			AssertVisible(
				key_append = "[normalize-space(text())='Go Somewhere']",
				key_url = "https://www.liferay.com",
				locator1 = "Fragment#FRAGMENT_LINK");

			Click(
				key_append = "[normalize-space(text())='Go Somewhere']",
				key_url = "https://www.liferay.com",
				locator1 = "Fragment#FRAGMENT_LINK");

			AssertLocation.assertPartialLocation(value1 = "https://www.liferay.com");
		}
	}

	@description = "This is a test for LPS-98031. Map web content field with URL to text editable field."
	@priority = 2
	test MapWebContentFieldWithURLToTextFragment {
		task ("Add a web content structure with a Text field") {
			WebContentNavigator.openWebContentAdmin(siteURLKey = ${siteURLKey});

			NavItem.gotoStructures();

			WebContentStructures.addCP(structureName = "WC Structure Name");

			DataEngine.addField(
				fieldFieldLabel = "Text",
				fieldName = "Text");

			WebContentStructures.saveCP(structureName = "WC Structure Name");
		}

		task ("Add a display page template with Web Content Article and WC Structure Name") {
			DisplayPageTemplatesAdmin.openDisplayPagesAdmin(siteURLKey = ${siteURLKey});

			DisplayPageTemplatesAdmin.addDisplayPage(
				contentType = "Web Content Article",
				displayPageName = "Test Display Page Name",
				subType = "WC Structure Name");
		}

		task ("Add a Heading fragment to display page template") {
			PageEditor.addFragment(
				collectionName = "Basic Components",
				fragmentName = "Heading");
		}

		task ("Map link from Text field to Heading") {
			PageEditorEditableLink.gotoEditableFieldLink(
				fragmentName = "Heading",
				id = "element-text");

			PageEditorEditableLink.mapURLToAsset(field = "Text");

			PageEditor.publish();
		}

		task ("Add a web content based on new structure") {
			WebContentNavigator.openWebContentAdmin(siteURLKey = ${siteURLKey});

			WebContentNavigator.gotoAddWithStructureCP(structureName = "WC Structure Name");

			WebContent.addWithStructureCP(
				webContentText = "https://www.liferay.com",
				webContentTitle = "Web Content Title");
		}

		task ("Select Display Page Name as Specific Display Page Template") {
			WebContent.editDisplayPage(
				pageName = "Test Display Page Name",
				pageType = "Display Page Templates");

			PortletEntry.publish();
		}

		task ("View Content in display page template") {
			WebContentNavigator.openWebContentAdmin(siteURLKey = ${siteURLKey});

			WebContentNavigator.gotoEntryMenuItem(
				entry = "Web Content Title",
				menuItem = "View Content");

			ControlMenu.viewHeaderTitle(headerTitle = "Web Content Title");
		}

		task ("Assert mapped URL work in view mode") {
			AssertVisible(
				key_append = "[normalize-space(text())='Heading Example']",
				key_url = "https://www.liferay.com",
				locator1 = "Fragment#FRAGMENT_LINK");

			Click(
				key_append = "[normalize-space(text())='Heading Example']",
				key_url = "https://www.liferay.com",
				locator1 = "Fragment#FRAGMENT_LINK");

			AssertLocation.assertPartialLocation(value1 = "https://www.liferay.com");
		}
	}

	@description = "This is a test for LPS-98030. Can map the editable background images of a fragment to an existing image content in a display page template."
	@priority = 2
	test MapWebContentImageToBackgoundImageOfBannerCenter {
		task ("Add a web content structure with an Image field") {
			WebContentNavigator.openWebContentAdmin(siteURLKey = ${siteURLKey});

			NavItem.gotoStructures();

			WebContentStructures.addCP(structureName = "WC Structure Name");

			DataEngine.addField(
				fieldFieldLabel = "Image",
				fieldName = "Image");

			WebContentStructures.saveCP(structureName = "WC Structure Name");
		}

		task ("Add a display page template with Web Content Article and WC Structure Name") {
			DisplayPageTemplatesAdmin.openDisplayPagesAdmin(siteURLKey = ${siteURLKey});

			DisplayPageTemplatesAdmin.addDisplayPage(
				contentType = "Web Content Article",
				displayPageName = "Test Display Page Name",
				subType = "WC Structure Name");
		}

		task ("Add a Banner Center fragment to display page template") {
			PageEditor.addFragment(
				collectionName = "Featured Content",
				composition = "true",
				fragmentName = "Banner Center");
		}

		task ("Map web content image to background image field of Banner Center") {
			PageEditor.editLayoutContainer(
				backgroundImage = "Mapping",
				fieldName = "Image",
				panel = "Styles");

			PageEditor.publish();
		}

		task ("Add a web content based on new structure") {
			WebContentNavigator.openWebContentAdmin(siteURLKey = ${siteURLKey});

			WebContentNavigator.gotoAddWithStructureCP(structureName = "WC Structure Name");

			WebContent.addWithStructureCP(
				navTab = "Web Content Images",
				structureName = "WC Structure Name",
				webContentImage = "Document_2.jpeg",
				webContentTitle = "Web Content Title");
		}

		task ("Select Display Page Name as Specific Display Page Template") {
			WebContent.editDisplayPage(
				pageName = "Test Display Page Name",
				pageType = "Display Page Templates");

			PortletEntry.publish();
		}

		task ("View Content in display page template") {
			WebContentNavigator.openWebContentAdmin(siteURLKey = ${siteURLKey});

			WebContentNavigator.gotoEntryMenuItem(
				entry = "Web Content Title",
				menuItem = "View Content");

			ControlMenu.viewHeaderTitle(headerTitle = "Web Content Title");
		}

		task ("Assert mapped image is shown in display page template") {
			ContentPages.viewFragmentBackgroundImage(image = "Document_2.jpeg");
		}
	}

	@description = "This is a test for LPS-118979. The mappable fields are grouped by fieldset in display page template."
	@priority = 4
	test ViewMappableFieldsAreGroupedByFieldset {
		task ("Add a custom Document type") {
			DMNavigator.openDocumentTypesAdmin(siteURLKey = ${siteURLKey});

			DMDocumentType.add(
				dmDocumentTypeDescription = "DM Document Type Description",
				dmDocumentTypeFieldNames = "Text",
				dmDocumentTypeName = "DM Document Type Name");
		}

		task ("Add a Heading fragment to the Display Page Name") {
			DisplayPageTemplatesAdmin.openDisplayPagesAdmin(siteURLKey = ${siteURLKey});

			DisplayPageTemplatesAdmin.gotoDisplayPage(displayPageName = "Display Page Name");

			PageEditor.addFragment(
				collectionName = "Basic Components",
				fragmentName = "Heading");
		}

		task ("Assert the mappable fields are grouped by fieldset") {
			PageEditorMapping.gotoEditableFieldMapping(
				contributed = "true",
				fragmentName = "Heading",
				id = "text");

			AssertElementPresent(
				key_fieldLabel = "Source",
				locator1 = "Select#GENERIC_SELECT_FIELD",
				value1 = "Basic Web Content (Default)");

			for (var field : list "Title,Description,Publish Date,Author Name,Last Editor Name") {
				AssertElementPresent(
					key_fieldLabel = "Field",
					key_groupLabel = "Basic Information",
					key_value = ${field},
					locator1 = "Select#GROUPED_SELECT_VALUE");
			}

			AssertElementPresent(
				key_fieldLabel = "Field",
				key_groupLabel = "Content (Basic Web Content)",
				key_value = "Content",
				locator1 = "Select#GROUPED_SELECT_VALUE");

			AssertElementPresent(
				key_fieldLabel = "Field",
				key_groupLabel = "Templates",
				key_value = "Basic Web Content",
				locator1 = "Select#GROUPED_SELECT_VALUE");

			AssertElementPresent(
				key_fieldLabel = "Field",
				key_groupLabel = "Display Page",
				key_value = "Display Page URL",
				locator1 = "Select#GROUPED_SELECT_VALUE");

			for (var field : list "All Categories,Topic,Tags") {
				AssertElementPresent(
					key_fieldLabel = "Field",
					key_groupLabel = "Categorization",
					key_value = ${field},
					locator1 = "Select#GROUPED_SELECT_VALUE");
			}

			for (var field : list "Display Date,Expiration Date") {
				AssertElementPresent(
					key_fieldLabel = "Field",
					key_groupLabel = "Schedule",
					key_value = ${field},
					locator1 = "Select#GROUPED_SELECT_VALUE");
			}
		}

		task ("Add a display page template based on Blogs Entry") {
			JSONLayoutpagetemplate.addDisplayPageTemplateEntry(
				contentType = "Blogs Entry",
				displayPageTemplateEntryName = "Display Page Name 2",
				groupName = ${randomSiteName});
		}

		task ("Add a Heading fragment to the Display Page Name 2") {
			DisplayPageTemplatesAdmin.openDisplayPagesAdmin(siteURLKey = ${siteURLKey});

			DisplayPageTemplatesAdmin.gotoDisplayPage(displayPageName = "Display Page Name 2");

			PageEditor.addFragment(
				collectionName = "Basic Components",
				fragmentName = "Heading");
		}

		task ("Assert the mappable fields are grouped by fieldset") {
			PageEditorMapping.gotoEditableFieldMapping(
				contributed = "true",
				fragmentName = "Heading",
				id = "text");

			AssertElementPresent(
				key_fieldLabel = "Source",
				locator1 = "Select#GENERIC_SELECT_FIELD",
				value1 = "Blogs Entry (Default)");

			for (var field : list "Title,Author Name") {
				AssertElementPresent(
					key_fieldLabel = "Field",
					key_groupLabel = "Basic Information",
					key_value = ${field},
					locator1 = "Select#GROUPED_SELECT_VALUE");
			}

			for (var field : list "Subtitle,Cover Image Caption,Content") {
				AssertElementPresent(
					key_fieldLabel = "Field",
					key_groupLabel = "Content",
					key_value = ${field},
					locator1 = "Select#GROUPED_SELECT_VALUE");
			}

			for (var field : list "Display Page URL,Description,Display Date") {
				AssertElementPresent(
					key_fieldLabel = "Field",
					key_groupLabel = "Configuration",
					key_value = ${field},
					locator1 = "Select#GROUPED_SELECT_VALUE");
			}

			for (var field : list "All Categories,Topic,Tags") {
				AssertElementPresent(
					key_fieldLabel = "Field",
					key_groupLabel = "Categorization",
					key_value = ${field},
					locator1 = "Select#GROUPED_SELECT_VALUE");
			}
		}

		task ("Add a display page template based on Document and new document type") {
			DisplayPageTemplatesAdmin.openDisplayPagesAdmin(siteURLKey = ${siteURLKey});

			DisplayPageTemplatesAdmin.addDisplayPage(
				contentType = "Document",
				displayPageName = "Display Page Name 3",
				subType = "DM Document Type Name");
		}

		task ("Add a Heading fragment to the Display Page Name 3") {
			PageEditor.addFragment(
				collectionName = "Basic Components",
				fragmentName = "Heading");
		}

		task ("Assert the mappable fields are grouped by fieldset") {
			PageEditorMapping.gotoEditableFieldMapping(
				contributed = "true",
				fragmentName = "Heading",
				id = "text");

			AssertElementPresent(
				key_fieldLabel = "Source",
				locator1 = "Select#GENERIC_SELECT_FIELD",
				value1 = "Basic Document (Default)");

			for (var field : list "Title,Description,Version,Publish Date,Author Name") {
				AssertElementPresent(
					key_fieldLabel = "Field",
					key_groupLabel = "Basic Information",
					key_value = ${field},
					locator1 = "Select#GROUPED_SELECT_VALUE");
			}

			for (var field : list "File Name,Download URL,MIME Type,Size") {
				AssertElementPresent(
					key_fieldLabel = "Field",
					key_groupLabel = "File Information",
					key_value = ${field},
					locator1 = "Select#GROUPED_SELECT_VALUE");
			}

			AssertElementPresent(
				key_fieldLabel = "Field",
				key_groupLabel = "DM Document Type Name",
				key_value = "Text",
				locator1 = "Select#GROUPED_SELECT_VALUE");

			for (var field : list "All Categories,Topic,Tags") {
				AssertElementPresent(
					key_fieldLabel = "Field",
					key_groupLabel = "Categorization",
					key_value = ${field},
					locator1 = "Select#GROUPED_SELECT_VALUE");
			}
		}
	}

	@description = "This is a test for LPS-120504. View mapped image after sort documents in display page template."
	@priority = 4
	test ViewMappedImageAfterSortDocumentsInDisplayPageTemplate {
		task ("Add a display page template based on Document and Basic Document") {
			JSONLayoutpagetemplate.addDisplayPageTemplateEntry(
				contentType = "Document",
				displayPageTemplateEntryName = "Document Display Page",
				groupName = ${randomSiteName},
				subType = "Basic Document");
		}

		task ("Add an Image fragment to display page template") {
			DisplayPageTemplatesAdmin.openDisplayPagesAdmin(siteURLKey = ${siteURLKey});

			DisplayPageTemplatesAdmin.gotoDisplayPageEllipsisItem(
				displayPageName = "Document Display Page",
				item = "Edit");

			PageEditor.addFragment(
				collectionName = "Basic Components",
				fragmentName = "Image");
		}

		task ("Map File URL of document to editable field of Image") {
			PageEditorMapping.mapEditableTextToField(
				field = "File URL",
				fragmentName = "Image",
				id = "image-square",
				source = "Basic Document (Default)");
		}

		task ("Add a Documents and Media widget below the Image") {
			PageEditor.addWidget(
				portletName = "Documents and Media",
				targetFragmentName = "Image");
		}

		task ("Mark the display page template as default") {
			PageEditor.publish();

			DisplayPageTemplatesAdmin.markDisplayPageAsDefault(displayPageName = "Document Display Page");
		}

		task ("Add an Asset Publisher to a widget page") {
			JSONLayout.addPublicLayout(
				groupName = ${randomSiteName},
				layoutName = "Test Page Name");

			JSONLayout.addWidgetToPublicLayout(
				groupName = ${randomSiteName},
				layoutName = "Test Page Name",
				widgetName = "Asset Publisher");
		}

		task ("Add the first document with an image") {
			DMNavigator.openDocumentsAndMediaAdmin(siteURLKey = ${siteURLKey});

			DMDocument.addCP(
				dmDocumentFile = "Document_1.jpg",
				dmDocumentTitle = "Document Title 1");
		}

		task ("Add the second document with an image") {
			DMNavigator.openDocumentsAndMediaAdmin(siteURLKey = ${siteURLKey});

			DMDocument.addCP(
				dmDocumentFile = "Document_2.jpg",
				dmDocumentTitle = "Document Title 2");
		}

		task ("Navigate to display page template related to the first document via Asset Publisher") {
			Navigator.gotoSitePage(
				pageName = "Test Page Name",
				siteName = ${randomSiteName});

			for (var title : list "Document Title 1,Document Title 2") {
				AssertTextEquals(
					key_assetTitle = ${title},
					locator1 = "AP#ASSET_ABSTRACT_TITLE",
					value1 = ${title});
			}

			AssetPublisherPortlet.clickAssetTitle(assetTitle = "Document Title 1");
		}

		task ("Assert the image of the Document Title 1 is shown in Image fragment") {
			AssertVisible(
				id = "image-square",
				key_image = "Document_1.jpg",
				key_imageDescription = "",
				locator1 = "Fragment#CONTRIBUTED_FRAGMENT_EDITABLE_FIELD_IMAGE_PROPERTIES");
		}

		task ("Assert the order of documents in Documents and Media") {
			var n = 1;

			for (var title : list "Document Title 2,Document Title 1") {
				LexiconCard.viewCardOrder(
					card = ${title},
					index = ${n});

				var n = ${n} + 1;
			}
		}

		task ("Reverse Sort Direction in Documents and Media") {
			Click(locator1 = "ManagementBar#ORDER_ICON_GENERIC");
		}

		task ("Assert the order of documents in Documents and Media") {
			var n = 1;

			for (var title : list "Document Title 1,Document Title 2") {
				LexiconCard.viewCardOrder(
					card = ${title},
					index = ${n});

				var n = ${n} + 1;
			}
		}

		task ("Assert the image of the Document Title 1 is still shown in Image fragment") {
			AssertVisible(
				id = "image-square",
				key_image = "Document_1.jpg",
				key_imageDescription = "",
				locator1 = "Fragment#CONTRIBUTED_FRAGMENT_EDITABLE_FIELD_IMAGE_PROPERTIES");
		}
	}

	@description = "This is a test for LPS-118060. The contributed content types and their subtypes are available when creating a display page template."
	@priority = 5
	test ViewTypesDuringCreation {
		property portal.acceptance = "true";

		task ("Add a custom Web Content structure") {
			WebContentNavigator.openWebContentAdmin(siteURLKey = ${siteURLKey});

			NavItem.gotoStructures();

			WebContentStructures.addCP(
				structureDescription = "WC Structure Description",
				structureName = "WC Structure Name");

			DataEngine.addField(
				fieldFieldLabel = "Text",
				fieldName = "Text");

			WebContentStructures.saveCP(structureName = "WC Structure Name");
		}

		task ("Add a custom Document type") {
			DMNavigator.openDocumentTypesAdmin(siteURLKey = ${siteURLKey});

			DMDocumentType.add(
				dmDocumentTypeDescription = "DM Document Type Description",
				dmDocumentTypeFieldNames = "Text",
				dmDocumentTypeName = "DM Document Type Name");
		}

		task ("View all contributed content types and their subtypes when creating a display page template") {
			DisplayPageTemplatesAdmin.openDisplayPagesAdmin(siteURLKey = ${siteURLKey});

			LexiconEntry.gotoAdd();

			LexiconCard.clickCard(card = "Blank");

			PortletEntry.inputName(name = "Display Page Template Name");

			for (var contentType : list "Web Content Article,Document,Blogs Entry") {
				AssertElementPresent(
					key_fieldLabel = "Content Type",
					key_value = ${contentType},
					locator1 = "Select#GENERIC_SELECT_VALUE");
			}

			AssertElementNotPresent(
				key_fieldLabel = "Content Type",
				key_value = "Asset",
				locator1 = "Select#GENERIC_SELECT_VALUE");

			Select(
				key_fieldLabel = "Content Type",
				locator1 = "Select#GENERIC_SELECT_FIELD",
				value1 = "Web Content Article");

			WaitForEditable(
				key_fieldLabel = "Subtype",
				locator1 = "Select#GENERIC_SELECT_FIELD");

			for (var subtype : list "Basic Web Content,WC Structure Name") {
				AssertElementPresent(
					key_fieldLabel = "Subtype",
					key_value = ${subtype},
					locator1 = "Select#GENERIC_SELECT_VALUE");
			}

			Select(
				key_fieldLabel = "Content Type",
				locator1 = "Select#GENERIC_SELECT_FIELD",
				value1 = "Document");

			WaitForEditable(
				key_fieldLabel = "Subtype",
				locator1 = "Select#GENERIC_SELECT_FIELD");

			for (var subtype : list "Basic Document,Google Drive Shortcut,DM Document Type Name") {
				AssertElementPresent(
					key_fieldLabel = "Subtype",
					key_value = ${subtype},
					locator1 = "Select#GENERIC_SELECT_VALUE");
			}
		}
	}

}