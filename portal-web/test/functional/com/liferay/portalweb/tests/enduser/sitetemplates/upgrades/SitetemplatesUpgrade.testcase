@component-name = "portal-upgrades"
definition {

	property ci.retries.disabled = "true";
	property database.types = "db2,mariadb,mysql,oracle,postgresql,sqlserver,sybase";
	property portal.release = "true";
	property portal.upstream = "true";
	property test.liferay.virtual.instance = "false";
	property testray.main.component.name = "Upgrades Staging";

	setUp {
		SignIn.signIn();

		SearchAdministration.executeReindex();
	}

	@description = "This is a use case for LPS-174465 and LPS-174471. TC-7 Verify that the exclamation mark are present after upgrade."
	@priority = 4
	test ExclamationMarkPresentAfterUpgrade73101 {
		property custom.properties = "feature.flag.LPS-174417=true";
		property data.archive.type = "data-archive-page-with-collision";
		property portal.version = "7.3.10.1";

		task ("When: Navigate to page admin of the Site template") {
			SiteTemplatesNavigator.openPagesAdmin(siteTemplateName = "Site Template Name");
		}

		task ("Then: Verify a warning with an exclamation mark next to the name of the collision site page") {
			SiteTemplates.viewTooltipOfExclamationMark(pageName = "Page1");
		}

		task ("When: Navigate to page admin of the site") {
			PagesAdmin.openPagesAdmin(siteURLKey = "Site Name");
		}

		task ("Then: Verify a warning with an exclamation mark next to the name of the collision site page") {
			SiteTemplates.viewTooltipOfExclamationMark(pageName = "Page1");
		}

		task ("When: Navigate to page tree of the Site template") {
			SiteTemplatesNavigator.gotoSiteTemplatesPage(
				pageName = "Home",
				siteTemplateName = "Site Template Name");

			PagesFinder.goToPagesFinder();
		}

		task ("Then: Verify a warning with an exclamation mark next to the name of the collision site page") {
			SiteTemplates.viewTooltipOfExclamationMark(pageName = "Page1");
		}

		task ("When: Navigate to page tree of the site") {
			Navigator.gotoSitePage(
				pageName = "Home",
				siteName = "Site Name");
		}

		task ("Then: Verify a warning with an exclamation mark next to the name of the collision site page") {
			SiteTemplates.viewTooltipOfExclamationMark(pageName = "Page1");
		}
	}

	@description = "This is a use case for LPS-174465 and LPS-174471. TC-8 Verify that the exclamation mark are present after upgrade."
	@priority = 4
	test ExclamationMarkPresentAfterUpgrade701016 {
		property custom.properties = "feature.flag.LPS-174417=true";
		property data.archive.type = "data-archive-page-with-collision";
		property portal.version = "7.0.10.16";

		task ("When: Navigate to page admin of the Site template") {
			SiteTemplatesNavigator.openPagesAdmin(siteTemplateName = "Site Template Name");
		}

		task ("Then: Verify a warning with an exclamation mark next to the name of the collision site page") {
			SiteTemplates.viewTooltipOfExclamationMark(pageName = "Page1");
		}

		task ("When: Navigate to page admin of the site") {
			PagesAdmin.openPagesAdmin(siteURLKey = "Site Name");
		}

		task ("Then: Verify a warning with an exclamation mark next to the name of the collision site page") {
			SiteTemplates.viewTooltipOfExclamationMark(pageName = "Page1");
		}

		task ("When: Navigate to page tree of the Site template") {
			SiteTemplatesNavigator.gotoSiteTemplatesPage(
				pageName = "home",
				siteTemplateName = "Site Template Name");

			PagesFinder.goToPagesFinder();
		}

		task ("Then: Verify a warning with an exclamation mark next to the name of the collision site page") {
			SiteTemplates.viewTooltipOfExclamationMark(pageName = "Page1");
		}

		task ("When: Navigate to page tree of the site") {
			Navigator.gotoSitePage(
				pageName = "home",
				siteName = "Site Name");
		}

		task ("Then: Verify a warning with an exclamation mark next to the name of the collision site page") {
			SiteTemplates.viewTooltipOfExclamationMark(pageName = "Page1");
		}
	}

	@description = "This is a use case for LPS-138633. User can edit the name and the status of a template after upgrade."
	@priority = 5
	test TemplateNameAndStatusCanBeEditedAfterUpgrade71103 {
		property data.archive.type = "data-archive-deactivated-template";
		property database.types = "db2,mysql,oracle,postgresql,sybase";
		property portal.version = "7.1.10.3";

		task ("Change the new site template's name then verify it") {
			SiteTemplatesNavigator.openSiteTemplatesAdmin();

			SiteTemplates.editCP(siteTemplateName = "Site Template Name");

			SiteTemplatesNavigator.openSiteTemplatesAdmin();

			SiteTemplates.viewCP(siteTemplateName = "Site Template Name Edit");
		}

		task ("Change the new site's status to active then verify it") {
			SiteTemplates.activateCP(siteTemplateName = "Site Template Name Edit");

			SiteTemplatesNavigator.openSiteTemplatesAdmin();

			SiteTemplates.viewTemplateStatusCP(
				siteTemplateActiveEdit = "Yes",
				siteTemplateName = "Site Template Name Edit");
		}
	}

	@description = "This is a use case for LPS-138633. User can edit the name and the status of a template after upgrade."
	@priority = 5
	test TemplateNameAndStatusCanBeEditedAfterUpgrade72101 {
		property data.archive.type = "data-archive-deactivated-template";
		property database.types = "db2,mysql,oracle,postgresql,sybase";
		property portal.version = "7.2.10.1";

		task ("Change the new site template's name then verify it") {
			SiteTemplatesNavigator.openSiteTemplatesAdmin();

			SiteTemplates.editCP(siteTemplateName = "Site Template Name");

			SiteTemplatesNavigator.openSiteTemplatesAdmin();

			SiteTemplates.viewCP(siteTemplateName = "Site Template Name Edit");
		}

		task ("Change the new site's status to active then verify it") {
			SiteTemplates.activateCP(siteTemplateName = "Site Template Name Edit");

			SiteTemplatesNavigator.openSiteTemplatesAdmin();

			SiteTemplates.viewTemplateStatusCP(
				siteTemplateActiveEdit = "Yes",
				siteTemplateName = "Site Template Name Edit");
		}
	}

	@description = "This is a use case for LPS-138633. User can edit the name and the status of a template after upgrade."
	@priority = 5
	test TemplateNameAndStatusCanBeEditedAfterUpgrade73101 {
		property data.archive.type = "data-archive-deactivated-template";
		property database.types = "db2,mysql,oracle,postgresql,sybase";
		property portal.version = "7.3.10.1";

		task ("Change the new site template's name then verify it") {
			SiteTemplatesNavigator.openSiteTemplatesAdmin();

			SiteTemplates.editCP(siteTemplateName = "Site Template Name");

			SiteTemplatesNavigator.openSiteTemplatesAdmin();

			SiteTemplates.viewCP(siteTemplateName = "Site Template Name Edit");
		}

		task ("Change the new site's status to active then verify it") {
			SiteTemplates.activateCP(siteTemplateName = "Site Template Name Edit");

			SiteTemplatesNavigator.openSiteTemplatesAdmin();

			SiteTemplates.viewTemplateStatusCP(
				siteTemplateActiveEdit = "Yes",
				siteTemplateName = "Site Template Name Edit");
		}
	}

	@description = "This is a use case for LPS-138633. User can edit the name and the status of a template after upgrade."
	@priority = 5
	test TemplateNameAndStatusCanBeEditedAfterUpgrade701016 {
		property data.archive.type = "data-archive-deactivated-template";
		property database.types = "db2,mysql,oracle,postgresql,sybase";
		property portal.version = "7.0.10.16";

		task ("Change the new site template's name then verify it") {
			SiteTemplatesNavigator.openSiteTemplatesAdmin();

			SiteTemplates.editCP(siteTemplateName = "Site Template Name");

			SiteTemplatesNavigator.openSiteTemplatesAdmin();

			SiteTemplates.viewCP(siteTemplateName = "Site Template Name Edit");
		}

		task ("Change the new site's status to active then verify it") {
			SiteTemplates.activateCP(siteTemplateName = "Site Template Name Edit");

			SiteTemplatesNavigator.openSiteTemplatesAdmin();

			SiteTemplates.viewTemplateStatusCP(
				siteTemplateActiveEdit = "Yes",
				siteTemplateName = "Site Template Name Edit");
		}
	}

	@description = "Disabling propagation of the template should work after an upgrade. User can disable propagation and prevent any changes on template from reaching the site created from it."
	@priority = 5
	test TemplatePropagationShouldWorkAfterUpgrade71103 {
		property data.archive.type = "data-archive-page-from-template";
		property database.types = "db2,mysql,oracle,postgresql,sybase";
		property portal.version = "7.1.10.3";

		task ("Verify that the AP Widget is still present on the Site Name page") {
			Navigator.gotoSitePage(
				pageName = "Home",
				siteName = "Site Name");

			Refresh();

			Portlet.viewPG(portletName = "Asset Publisher");
		}

		task ("Disable propagation on the created template") {
			SiteTemplatesNavigator.openSiteTemplatesAdmin();

			SiteTemplates.disablePropagation(siteTemplateName = "Site Template Name");
		}

		task ("Delete the AP widget from the created template") {
			SiteTemplatesNavigator.gotoSiteTemplatesPage(
				pageName = "Home",
				siteTemplateName = "Site Template Name");

			Portlet.deletePG(key_portletName = "Asset Publisher");
		}

		task ("Verify that the AP Widget is still present on the Site Name page") {
			Navigator.gotoSitePage(
				pageName = "Home",
				siteName = "Site Name");

			Refresh();

			Portlet.viewPG(portletName = "Asset Publisher");
		}
	}

	@description = "Disabling propagation of the template should work after an upgrade. User can disable propagation and prevent any changes on template from reaching the site created from it."
	@priority = 5
	test TemplatePropagationShouldWorkAfterUpgrade72101 {
		property data.archive.type = "data-archive-page-from-template";
		property database.types = "db2,mysql,oracle,postgresql,sybase";
		property portal.version = "7.2.10.1";

		task ("Verify that the AP Widget is still present on the Site Name page") {
			Navigator.gotoSitePage(
				pageName = "Home",
				siteName = "Site Name");

			Refresh();

			Portlet.viewPG(portletName = "Asset Publisher");
		}

		task ("Disable propagation on the created template") {
			SiteTemplatesNavigator.openSiteTemplatesAdmin();

			SiteTemplates.disablePropagation(siteTemplateName = "Site Template Name");
		}

		task ("Delete the AP widget from the created template") {
			SiteTemplatesNavigator.gotoSiteTemplatesPage(
				pageName = "Home",
				siteTemplateName = "Site Template Name");

			Portlet.deletePG(key_portletName = "Asset Publisher");
		}

		task ("Verify that the AP Widget is still present on the Site Name page") {
			Navigator.gotoSitePage(
				pageName = "Home",
				siteName = "Site Name");

			Refresh();

			Portlet.viewPG(portletName = "Asset Publisher");
		}
	}

	@description = "Disabling propagation of the template should work after an upgrade. User can disable propagation and prevent any changes on template from reaching the site created from it."
	@priority = 5
	test TemplatePropagationShouldWorkAfterUpgrade73101 {
		property data.archive.type = "data-archive-page-from-template";
		property database.types = "db2,mysql,oracle,postgresql,sybase";
		property portal.version = "7.3.10.1";

		task ("Verify that the AP Widget is still present on the Site Name page") {
			Navigator.gotoSitePage(
				pageName = "Home",
				siteName = "Site Name");

			Refresh();

			Alert.viewInfoMessageSpecific(infoMessage = "There are no results.");
		}

		task ("Disable propagation on the created template") {
			SiteTemplatesNavigator.openSiteTemplatesAdmin();

			SiteTemplates.disablePropagation(siteTemplateName = "Site Template Name");
		}

		task ("Delete the AP widget from the created template") {
			SiteTemplates.openSiteTemplateInEditMode(siteTemplateName = "Site Template Name");

			PageEditor.removeFragment(fragmentName = "Asset Publisher");
		}

		task ("Verify that the AP Widget is still present on the Site Name page") {
			Navigator.gotoSitePage(
				pageName = "Home",
				siteName = "Site Name");

			Refresh();

			Alert.viewInfoMessageSpecific(infoMessage = "There are no results.");
		}
	}

	@description = "Disabling propagation of the template should work after an upgrade. User can disable propagation and prevent any changes on template from reaching the site created from it."
	@priority = 5
	test TemplatePropagationShouldWorkAfterUpgrade701016 {
		property data.archive.type = "data-archive-page-from-template";
		property database.types = "db2,mysql,oracle,postgresql,sybase";
		property portal.version = "7.0.10.16";

		task ("Verify that the AP Widget is still present on the Site Name page") {
			Navigator.gotoSitePage(
				pageName = "home",
				siteName = "Site Name");

			Refresh();

			Portlet.viewPG(portletName = "Asset Publisher");
		}

		task ("Disable propagation on the created template") {
			SiteTemplatesNavigator.openSiteTemplatesAdmin();

			SiteTemplates.disablePropagation(siteTemplateName = "Site Template Name");
		}

		task ("Delete the AP widget from the created template") {
			SiteTemplates.openSiteTemplateInEditMode(
				siteTemplateName = "Site Template Name",
				widgetPage = "true");

			Portlet.deletePG(key_portletName = "Asset Publisher");
		}

		task ("Verify that the AP Widget is still present on the Site Name page") {
			Navigator.gotoSitePage(
				pageName = "home",
				siteName = "Site Name");

			Refresh();

			Portlet.viewPG(portletName = "Asset Publisher");
		}
	}

}