@component-name = "portal-wcm"
definition {

	property ci.retries.disabled = "true";
	property portal.release = "true";
	property portal.upstream = "true";
	property testray.main.component.name = "Pages Tree";

	static var randomSiteName = StringUtil.randomString(8);

	var siteURLKey = StringUtil.toLowerCase(${randomSiteName});

	setUp {
		task ("Set up virtual instance") {
			TestCase.setUpPortalInstance();
		}

		task ("Sign in") {
			User.firstLoginPG();
		}

		task ("Add a site") {
			HeadlessSite.addSite(siteName = ${randomSiteName});
		}
	}

	@description = "This is a test for LPS-178476. No alert should be displayed for a page with the XSS title visited by page tree."
	@priority = 4
	test AccessToPageTreeWherePageNameWithXSS {
		task ("Given a user has a page with XSS in name") {
			JSONLayout.addPublicLayout(
				groupName = ${randomSiteName},
				layoutName = "Test Page Name",
				type = "content");

			JSONLayout.publishLayout(
				groupName = ${randomSiteName},
				layoutName = "Test Page Name");

			PagesAdmin.openPagesAdmin(siteURLKey = ${randomSiteName});

			PagesAdmin.gotoPageEllipsisMenuItem(
				menuItem = "Configure",
				pageName = "Test Page Name");

			PagesAdmin.editName(pageNameEdit = "<script>alert(123);</script>");
		}

		task ("When the user accesses to the Page Tree") {
			PagesFinder.goToPagesFinder();
		}

		task ("Then the user shouldn't see alert popup") {
			AssertAlertNotPresent();
		}
	}

}