import aQute.bnd.osgi.Constants

import org.gradle.util.VersionNumber

buildscript {
	dependencies {
		classpath group: "biz.aQute.bnd", name: "biz.aQute.bnd.gradle", version: "5.3.0"
	}

	repositories {
		maven {
			url "https://repository-cdn.liferay.com/nexus/content/groups/public"
		}
	}
}

apply plugin: "biz.aQute.bnd.builder"
apply plugin: "java-library"
apply plugin: "maven-publish"

Properties bndProperties = _getBndProperties(project)

archivesBaseName = bndProperties[Constants.BUNDLE_SYMBOLICNAME]
group = "com.example"
version = bndProperties[Constants.BUNDLE_VERSION]

jar {
	bnd "-include": "bnd.bnd"
}

publishing {
	publications {
		maven(MavenPublication) {
			artifactId archivesBaseName
			groupId group
			version version

			from components.java
		}
	}
}

private Properties _getBndProperties(Project project) {
	Properties bndProperties = new Properties()

	File bndFile = project.file("bnd.bnd")

	bndFile.withInputStream {
		bndProperties.load it
	}

	bndProperties
}